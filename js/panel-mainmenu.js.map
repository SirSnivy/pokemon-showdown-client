{"version":3,"sources":["../src/panel-mainmenu.tsx"],"names":["MainMenuRoom","classType","userdetailsCache","roomsCache","receiveLine","args","cmd","challstr","PSLoginServer","query","act","then","res","loggedin","send","username","assertion","fullName","namedCode","avatar","PS","user","setName","challengesBuf","receiveChallenges","queryId","responseJSON","handleQueryResponse","JSON","parse","user1","user2","message","handlePM","parseFormats","alert","replace","lobby","rooms","dataBuf","json","userid","challengesFrom","getPMRoom","toID","challengeTo","to","roomid","room","pmTarget","targetUserid","challengedFormat","challengingFormat","format","update","formatsList","isSection","section","column","window","NonBattleGames","rps","BattleFormats","j","length","entry","teams","usesLocalLadder","charAt","isNaN","Number","slice","parseInt","name","searchShow","challengeShow","tournamentShow","team","teambuilderLevel","lastCommaIndex","lastIndexOf","code","substr","NaN","id","isTeambuilderFormat","teambuilderFormat","teambuilderFormatName","parenPos","indexOf","trim","rated","effectType","multivariantFormats","battleFormat","userid1","userid2","sort","join","addRoom","response","userdetails","Object","assign","userRoom","pspl","roomInfo","spotlight","chat","official","roomsRoom","battlesRoom","battleTable","battles","battleid","push","ladderRoomEntries","entries","filter","startsWith","ladderRoom","PSRoom","NewsPanel","render","props","__html","newsHTML","PSRoomPanel","MainMenuPanel","submit","e","handleDragStart","currentTarget","getAttribute","dragging","type","focus","base","querySelector","renderMiniRoom","roomType","roomTypes","Panel","Component","renderMiniRooms","miniRoomList","map","title","renderSearchButton","down","textAlign","Config","routes","client","isOffline","onlineButton","display","leftRoomWidth","server","dex","replays","root","FormatDropdown","change","value","forceUpdate","onChange","preact","TeamDropdown","teamFormat","teamKey","getDefaultTeam","list","key","formatData","Dex","getPokemonIcon","byKey","TeamForm","state","changeFormat","setState","target","preventDefault","undefined","onSubmit","children","Model"],"mappings":"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","sourcesContent":["/**\r\n * Main menu panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\ntype RoomInfo = {\r\n\ttitle: string, desc?: string, userCount?: number, section?: string, spotlight?: string, subRooms?: string[],\r\n};\r\n\r\nclass MainMenuRoom extends PSRoom {\r\n\treadonly classType: string = 'mainmenu';\r\n\tuserdetailsCache: {[userid: string]: {\r\n\t\tuserid: ID,\r\n\t\tavatar?: string | number,\r\n\t\tstatus?: string,\r\n\t\tgroup?: string,\r\n\t\tcustomgroup?: string,\r\n\t\trooms?: {[roomid: string]: {isPrivate?: true, p1?: string, p2?: string}},\r\n\t}} = {};\r\n\troomsCache: {\r\n\t\tbattleCount?: number,\r\n\t\tuserCount?: number,\r\n\t\tchat?: RoomInfo[],\r\n\t\tsectionTitles?: string[],\r\n\t} = {};\r\n\treceiveLine(args: Args) {\r\n\t\tconst [cmd] = args;\r\n\t\tswitch (cmd) {\r\n\t\tcase 'challstr': {\r\n\t\t\tconst [, challstr] = args;\r\n\t\t\tPSLoginServer.query({\r\n\t\t\t\tact: 'upkeep',\r\n\t\t\t\tchallstr,\r\n\t\t\t}).then(res => {\r\n\t\t\t\tif (!res) return;\r\n\t\t\t\tif (!res.loggedin) return;\r\n\t\t\t\tthis.send(`/trn ${res.username},0,${res.assertion}`);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t} case 'updateuser': {\r\n\t\t\tconst [, fullName, namedCode, avatar] = args;\r\n\t\t\tPS.user.setName(fullName, namedCode === '1', avatar);\r\n\t\t\treturn;\r\n\t\t} case 'updatechallenges': {\r\n\t\t\tconst [, challengesBuf] = args;\r\n\t\t\tthis.receiveChallenges(challengesBuf);\r\n\t\t\treturn;\r\n\t\t} case 'queryresponse': {\r\n\t\t\tconst [, queryId, responseJSON] = args;\r\n\t\t\tthis.handleQueryResponse(queryId as ID, JSON.parse(responseJSON));\r\n\t\t\treturn;\r\n\t\t} case 'pm': {\r\n\t\t\tconst [, user1, user2, message] = args;\r\n\t\t\tthis.handlePM(user1, user2, message);\r\n\t\t\treturn;\r\n\t\t} case 'formats': {\r\n\t\t\tthis.parseFormats(args);\r\n\t\t\treturn;\r\n\t\t} case 'popup': {\r\n\t\t\tconst [, message] = args;\r\n\t\t\talert(message.replace(/\\|\\|/g, '\\n'));\r\n\t\t\treturn;\r\n\t\t}}\r\n\t\tconst lobby = PS.rooms['lobby'];\r\n\t\tif (lobby) lobby.receiveLine(args);\r\n\t}\r\n\treceiveChallenges(dataBuf: string) {\r\n\t\tlet json;\r\n\t\ttry {\r\n\t\t\tjson = JSON.parse(dataBuf);\r\n\t\t} catch {}\r\n\t\tfor (const userid in json.challengesFrom) {\r\n\t\t\tPS.getPMRoom(toID(userid));\r\n\t\t}\r\n\t\tif (json.challengeTo) {\r\n\t\t\tPS.getPMRoom(toID(json.challengeTo.to));\r\n\t\t}\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid] as ChatRoom;\r\n\t\t\tif (!room.pmTarget) continue;\r\n\t\t\tconst targetUserid = toID(room.pmTarget);\r\n\t\t\tif (!room.challengedFormat && !(targetUserid in json.challengesFrom) &&\r\n\t\t\t\t!room.challengingFormat && json.challengeTo?.to !== targetUserid) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\troom.challengedFormat = json.challengesFrom[targetUserid] || null;\r\n\t\t\troom.challengingFormat = json.challengeTo?.to === targetUserid ? json.challengeTo.format : null;\r\n\t\t\troom.update(null);\r\n\t\t}\r\n\t}\r\n\tparseFormats(formatsList: string[]) {\r\n\t\tlet isSection = false;\r\n\t\tlet section = '';\r\n\r\n\t\tlet column = 0;\r\n\r\n\t\twindow.NonBattleGames = {rps: 'Rock Paper Scissors'};\r\n\t\twindow.BattleFormats = {};\r\n\t\tfor (let j = 1; j < formatsList.length; j++) {\r\n\t\t\tconst entry = formatsList[j];\r\n\t\t\tif (isSection) {\r\n\t\t\t\tsection = entry;\r\n\t\t\t\tisSection = false;\r\n\t\t\t} else if (entry === ',LL') {\r\n\t\t\t\tPS.teams.usesLocalLadder = true;\r\n\t\t\t} else if (entry === '' || (entry.charAt(0) === ',' && !isNaN(Number(entry.slice(1))))) {\r\n\t\t\t\tisSection = true;\r\n\r\n\t\t\t\tif (entry) {\r\n\t\t\t\t\tcolumn = parseInt(entry.slice(1), 10) || 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet name = entry;\r\n\t\t\t\tlet searchShow = true;\r\n\t\t\t\tlet challengeShow = true;\r\n\t\t\t\tlet tournamentShow = true;\r\n\t\t\t\tlet team: 'preset' | null = null;\r\n\t\t\t\tlet teambuilderLevel: number | null = null;\r\n\t\t\t\tlet lastCommaIndex = name.lastIndexOf(',');\r\n\t\t\t\tlet code = lastCommaIndex >= 0 ? parseInt(name.substr(lastCommaIndex + 1), 16) : NaN;\r\n\t\t\t\tif (!isNaN(code)) {\r\n\t\t\t\t\tname = name.substr(0, lastCommaIndex);\r\n\t\t\t\t\tif (code & 1) team = 'preset';\r\n\t\t\t\t\tif (!(code & 2)) searchShow = false;\r\n\t\t\t\t\tif (!(code & 4)) challengeShow = false;\r\n\t\t\t\t\tif (!(code & 8)) tournamentShow = false;\r\n\t\t\t\t\tif (code & 16) teambuilderLevel = 50;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Backwards compatibility: late 0.9.0 -> 0.10.0\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',#') { // preset teams\r\n\t\t\t\t\t\tteam = 'preset';\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',,') { // search-only\r\n\t\t\t\t\t\tchallengeShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t} else if (name.substr(name.length - 1) === ',') { // challenge-only\r\n\t\t\t\t\t\tsearchShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet id = toID(name);\r\n\t\t\t\tlet isTeambuilderFormat = !team && name.slice(-11) !== 'Custom Game';\r\n\t\t\t\tlet teambuilderFormat = '' as ID;\r\n\t\t\t\tlet teambuilderFormatName = '';\r\n\t\t\t\tif (isTeambuilderFormat) {\r\n\t\t\t\t\tteambuilderFormatName = name;\r\n\t\t\t\t\tif (id.slice(0, 3) !== 'gen') {\r\n\t\t\t\t\t\tteambuilderFormatName = '[Gen 6] ' + name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet parenPos = teambuilderFormatName.indexOf('(');\r\n\t\t\t\t\tif (parenPos > 0 && name.slice(-1) === ')') {\r\n\t\t\t\t\t\t// variation of existing tier\r\n\t\t\t\t\t\tteambuilderFormatName = teambuilderFormatName.slice(0, parenPos).trim();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (teambuilderFormatName !== name) {\r\n\t\t\t\t\t\tteambuilderFormat = toID(teambuilderFormatName);\r\n\t\t\t\t\t\tif (BattleFormats[teambuilderFormat]) {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat].isTeambuilderFormat = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat] = {\r\n\t\t\t\t\t\t\t\tid: teambuilderFormat,\r\n\t\t\t\t\t\t\t\tname: teambuilderFormatName,\r\n\t\t\t\t\t\t\t\tteam,\r\n\t\t\t\t\t\t\t\tsection,\r\n\t\t\t\t\t\t\t\tcolumn,\r\n\t\t\t\t\t\t\t\trated: false,\r\n\t\t\t\t\t\t\t\tisTeambuilderFormat: true,\r\n\t\t\t\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tisTeambuilderFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (BattleFormats[id]?.isTeambuilderFormat) {\r\n\t\t\t\t\tisTeambuilderFormat = true;\r\n\t\t\t\t}\r\n\t\t\t\t// make sure formats aren't out-of-order\r\n\t\t\t\tif (BattleFormats[id]) delete BattleFormats[id];\r\n\t\t\t\tBattleFormats[id] = {\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tteam,\r\n\t\t\t\t\tsection,\r\n\t\t\t\t\tcolumn,\r\n\t\t\t\t\tsearchShow,\r\n\t\t\t\t\tchallengeShow,\r\n\t\t\t\t\ttournamentShow,\r\n\t\t\t\t\trated: searchShow && id.substr(4, 7) !== 'unrated',\r\n\t\t\t\t\tteambuilderLevel,\r\n\t\t\t\t\tteambuilderFormat,\r\n\t\t\t\t\tisTeambuilderFormat,\r\n\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Match base formats to their variants, if they are unavailable in the server.\r\n\t\tlet multivariantFormats: {[id: string]: 1} = {};\r\n\t\tfor (let id in BattleFormats) {\r\n\t\t\tlet teambuilderFormat = BattleFormats[BattleFormats[id].teambuilderFormat!];\r\n\t\t\tif (!teambuilderFormat || multivariantFormats[teambuilderFormat.id]) continue;\r\n\t\t\tif (!teambuilderFormat.searchShow && !teambuilderFormat.challengeShow && !teambuilderFormat.tournamentShow) {\r\n\t\t\t\t// The base format is not available.\r\n\t\t\t\tif (teambuilderFormat.battleFormat) {\r\n\t\t\t\t\tmultivariantFormats[teambuilderFormat.id] = 1;\r\n\t\t\t\t\tteambuilderFormat.battleFormat = '';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tteambuilderFormat.battleFormat = id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tPS.teams.update('format');\r\n\t}\r\n\thandlePM(user1: string, user2: string, message: string) {\r\n\t\tconst userid1 = toID(user1);\r\n\t\tconst userid2 = toID(user2);\r\n\t\tconst roomid = `pm-${[userid1, userid2].sort().join('-')}` as RoomID;\r\n\t\tlet room = PS.rooms[roomid];\r\n\t\tif (!room) {\r\n\t\t\tconst pmTarget = PS.user.userid === userid1 ? user2 : user1;\r\n\t\t\tPS.addRoom({\r\n\t\t\t\tid: roomid,\r\n\t\t\t\tpmTarget,\r\n\t\t\t}, true);\r\n\t\t\troom = PS.rooms[roomid]!;\r\n\t\t}\r\n\t\troom.receiveLine([`c`, user1, message]);\r\n\t\tPS.update();\r\n\t}\r\n\thandleQueryResponse(id: ID, response: any) {\r\n\t\tswitch (id) {\r\n\t\tcase 'userdetails':\r\n\t\t\tlet userid = response.userid;\r\n\t\t\tlet userdetails = this.userdetailsCache[userid];\r\n\t\t\tif (!userdetails) {\r\n\t\t\t\tthis.userdetailsCache[userid] = response;\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(userdetails, response);\r\n\t\t\t}\r\n\t\t\tconst userRoom = PS.rooms[`user-${userid}`] as UserRoom;\r\n\t\t\tif (userRoom) userRoom.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'rooms':\r\n\t\t\tif (response.pspl) {\r\n\t\t\t\tfor (const roomInfo of response.pspl) roomInfo.spotlight = \"Spotlight\";\r\n\t\t\t\tresponse.chat = [...response.pspl, ...response.chat];\r\n\t\t\t\tresponse.pspl = null;\r\n\t\t\t}\r\n\t\t\tif (response.official) {\r\n\t\t\t\tfor (const roomInfo of response.official) roomInfo.section = \"Official\";\r\n\t\t\t\tresponse.chat = [...response.official, ...response.chat];\r\n\t\t\t\tresponse.official = null;\r\n\t\t\t}\r\n\t\t\tthis.roomsCache = response;\r\n\t\t\tconst roomsRoom = PS.rooms[`rooms`] as RoomsRoom;\r\n\t\t\tif (roomsRoom) roomsRoom.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'roomlist':\r\n\t\t\tconst battlesRoom = PS.rooms[`battles`] as BattlesRoom;\r\n\t\t\tif (battlesRoom) {\r\n\t\t\t\tconst battleTable = response.rooms;\r\n\t\t\t\tconst battles = [];\r\n\t\t\t\tfor (const battleid in battleTable) {\r\n\t\t\t\t\tbattleTable[battleid].id = battleid;\r\n\t\t\t\t\tbattles.push(battleTable[battleid]);\r\n\t\t\t\t}\r\n\t\t\t\tbattlesRoom.battles = battles;\r\n\t\t\t\tbattlesRoom.update(null);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'laddertop':\r\n\t\t\tconst ladderRoomEntries = Object.entries(PS.rooms).filter(entry => entry[0].startsWith('ladder'));\r\n\t\t\tfor (const [, ladderRoom] of ladderRoomEntries) {\r\n\t\t\t\t(ladderRoom as LadderRoom).update(response);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass NewsPanel extends PSRoomPanel {\r\n\trender() {\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\r\n\t\t\t<div class=\"mini-window-body\" dangerouslySetInnerHTML={{__html: PS.newsHTML}}></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass MainMenuPanel extends PSRoomPanel<MainMenuRoom> {\r\n\tfocus() {\r\n\t\t(this.base!.querySelector('button.big') as HTMLButtonElement).focus();\r\n\t}\r\n\tsubmit = (e: Event) => {\r\n\t\talert('todo: implement');\r\n\t};\r\n\thandleDragStart = (e: DragEvent) => {\r\n\t\tconst roomid = (e.currentTarget as HTMLElement).getAttribute('data-roomid') as RoomID;\r\n\t\tPS.dragging = {type: 'room', roomid};\r\n\t};\r\n\trenderMiniRoom(room: PSRoom) {\r\n\t\tconst roomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\trenderMiniRooms() {\r\n\t\treturn PS.miniRoomList.map(roomid => {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\treturn <div class=\"pmbox\">\r\n\t\t\t\t<div class=\"mini-window\">\r\n\t\t\t\t\t<h3 draggable onDragStart={this.handleDragStart} data-roomid={roomid}>\r\n\t\t\t\t\t\t<button class=\"closebutton\" name=\"closeRoom\" value={roomid} aria-label=\"Close\" tabIndex={-1}><i class=\"fa fa-times-circle\"></i></button>\r\n\t\t\t\t\t\t<button class=\"minimizebutton\" tabIndex={-1}><i class=\"fa fa-minus-circle\"></i></button>\r\n\t\t\t\t\t\t{room.title}\r\n\t\t\t\t\t</h3>\r\n\t\t\t\t\t{this.renderMiniRoom(room)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n\trenderSearchButton() {\r\n\t\tif (PS.down) {\r\n\t\t\treturn <div class=\"menugroup\" style=\"background: rgba(10,10,10,.6)\">\r\n\t\t\t\t{PS.down === 'ddos' ?\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to a DDoS attack!</strong></p>\r\n\t\t\t\t:\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to technical difficulties!</strong></p>\r\n\t\t\t\t}\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<div style={{textAlign: 'center'}}>\r\n\t\t\t\t\t\t<img width=\"96\" height=\"96\" src={`//${Config.routes.client}/sprites/gen5/teddiursa.png`} alt=\"\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\tBear with us as we freak out.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>(We'll be back up in a few hours.)</p>\r\n\t\t\t</div>;\r\n\t\t}\r\n\r\n\t\tif (!PS.user.userid || PS.isOffline) {\r\n\t\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submit}>\r\n\t\t\t\t<button class=\"mainmenu1 big button disabled\" name=\"search\">\r\n\t\t\t\t\t<em>{PS.isOffline ? \"Disconnected\" : \"Connecting...\"}</em>\r\n\t\t\t\t</button>\r\n\t\t\t</TeamForm>;\r\n\t\t}\r\n\r\n\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submit}>\r\n\t\t\t<button class=\"mainmenu1 big button\" name=\"search\">\r\n\t\t\t\t<strong>Battle!</strong><br />\r\n\t\t\t\t<small>Find a random opponent</small>\r\n\t\t\t</button>\r\n\t\t</TeamForm>;\r\n\t}\r\n\trender() {\r\n\t\tconst onlineButton = ' button' + (PS.isOffline ? ' disabled' : '');\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\r\n\t\t\t<div class=\"mainmenuwrapper\">\r\n\t\t\t\t<div class=\"leftmenu\">\r\n\t\t\t\t\t<div class=\"activitymenu\">\r\n\t\t\t\t\t\t{this.renderMiniRooms()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"mainmenu\">\r\n\t\t\t\t\t\t{this.renderSearchButton()}\r\n\r\n\t\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t\t<p><button class=\"mainmenu2 button\" name=\"joinRoom\" value=\"teambuilder\">Teambuilder</button></p>\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu3\" + onlineButton} name=\"joinRoom\" value=\"ladder\">Ladder</button></p>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu4\" + onlineButton} name=\"joinRoom\" value=\"battles\">Watch a battle</button></p>\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu5\" + onlineButton} name=\"finduser\">Find a user</button></p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"rightmenu\" style={{display: PS.leftRoomWidth ? 'none' : 'block'}}>\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t{PS.server.id === 'showdown' ?\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"rooms\">Join chat</button></p>\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"lobby\">Join lobby chat</button></p>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"mainmenufooter\">\r\n\t\t\t\t\t<div class=\"bgcredit\"></div>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/`} target=\"_blank\">Pok&eacute;dex</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.replays}/`} target=\"_blank\">Replays</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/rules`} target=\"_blank\">Rules</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/credits`} target=\"_blank\">Credits</a> | {}\r\n\t\t\t\t\t\t<a href=\"//smogon.com/forums/\" target=\"_blank\">Forum</a>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass FormatDropdown extends preact.Component<{format?: string, onChange?: JSX.EventHandler<Event>}> {\r\n\tdeclare base?: HTMLButtonElement;\r\n\tformat = '[Gen 7] Random Battle';\r\n\tchange = (e: Event) => {\r\n\t\tif (!this.base) return;\r\n\t\tthis.format = this.base.value;\r\n\t\tthis.forceUpdate();\r\n\t\tif (this.props.onChange) this.props.onChange(e);\r\n\t};\r\n\trender() {\r\n\t\tif (this.props.format) {\r\n\t\t\treturn <button\r\n\t\t\tname=\"format\" value={this.props.format} class=\"select formatselect preselected\" disabled\r\n\t\t\t>{this.props.format}</button>;\r\n\t\t}\r\n\t\treturn <button\r\n\t\t\tname=\"format\" value={this.format}\r\n\t\t\tclass=\"select formatselect\" data-href=\"/formatdropdown\" onChange={this.change}\r\n\t\t>\r\n\t\t\t{this.format}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nclass TeamDropdown extends preact.Component<{format: string}> {\r\n\tteamFormat = '';\r\n\tteamKey = '';\r\n\tchange = () => {\r\n\t\tif (!this.base) return;\r\n\t\tthis.teamKey = (this.base as HTMLButtonElement).value;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tgetDefaultTeam(teambuilderFormat: string) {\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tif (team.format === teambuilderFormat) return team.key;\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\trender() {\r\n\t\tconst teamFormat = PS.teams.teambuilderFormat(this.props.format);\r\n\t\tconst formatData = window.BattleFormats?.[teamFormat];\r\n\t\tif (formatData && formatData.team) {\r\n\t\t\treturn <button class=\"select teamselect preselected\" name=\"team\" value=\"random\" disabled>\r\n\t\t\t\t<div class=\"team\">\r\n\t\t\t\t\t<strong>Random team</strong>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\tif (teamFormat !== this.teamFormat) {\r\n\t\t\tthis.teamFormat = teamFormat;\r\n\t\t\tthis.teamKey = this.getDefaultTeam(teamFormat);\r\n\t\t}\r\n\t\tconst team = PS.teams.byKey[this.teamKey] || null;\r\n\t\treturn <button\r\n\t\t\tname=\"team\" value={this.teamKey}\r\n\t\t\tclass=\"select teamselect\" data-href=\"/teamdropdown\" data-format={teamFormat} onChange={this.change}\r\n\t\t>\r\n\t\t\t{PS.roomTypes['teamdropdown'] && <TeamBox team={team} noLink />}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nclass TeamForm extends preact.Component<{\r\n\tchildren: preact.ComponentChildren, class?: string, format?: string,\r\n\tonSubmit: null | ((e: Event, format: string, team?: Team) => void),\r\n}> {\r\n\tstate = {format: '[Gen 7] Random Battle'};\r\n\tchangeFormat = (e: Event) => {\r\n\t\tthis.setState({format: (e.target as HTMLButtonElement).value});\r\n\t};\r\n\tsubmit = (e: Event) => {\r\n\t\te.preventDefault();\r\n\t\tconst format = (this.base!.querySelector('button[name=format]') as HTMLButtonElement).value;\r\n\t\tconst teamKey = (this.base!.querySelector('button[name=team]') as HTMLButtonElement).value;\r\n\t\tconst team = teamKey ? PS.teams.byKey[teamKey] : undefined;\r\n\t\tif (this.props.onSubmit) this.props.onSubmit(e, format, team);\r\n\t};\r\n\trender() {\r\n\t\treturn <form class={this.props.class} onSubmit={this.submit}>\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tFormat:<br />\r\n\t\t\t\t\t<FormatDropdown onChange={this.changeFormat} format={this.props.format} />\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tTeam:<br />\r\n\t\t\t\t\t<TeamDropdown format={this.state.format} />\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<p>{this.props.children}</p>\r\n\t\t</form>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['news'] = {\r\n\tComponent: NewsPanel,\r\n};\r\n\r\nPS.roomTypes['mainmenu'] = {\r\n\tModel: MainMenuRoom,\r\n\tComponent: MainMenuPanel,\r\n};\r\n"],"file":"panel-mainmenu.js"}