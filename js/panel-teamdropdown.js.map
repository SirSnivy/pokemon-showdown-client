{"version":3,"sources":["../src/panel-teamdropdown.tsx"],"names":["PSTeambuilder","packTeam","team","buf","set","hasHP","name","species","id","toID","item","ability","moves","j","length","moveid","substr","slice","nature","evs","gender","ivs","shiny","level","happiness","undefined","pokeball","hpType","gigantamax","unpackTeam","split","setBuf","parts","push","Dex","get","items","baseSpecies","includes","abilities","map","hp","Number","atk","def","spa","spd","spe","parseInt","misc","exportSet","text","move","first","statNames","stat","BattleStatNames","isNaN","exportTeam","sets","splitPrefix","buffer","delimiter","prefixOffset","delimIndex","indexOf","splitLast","lastIndexOf","parseExportedTeamLine","line","isFirstLine","endsWith","parenIndex","charAt","startsWith","evLines","evLine","trim","spaceIndex","statid","BattleStatIDs","statval","ivLines","ivLine","match","natureIndex","types","isName","hpIVs","HPivs","importTeam","lines","curSet","shift","pop","PS","teams","unpackLine","packedTeam","importTeamBackup","curTeam","format","folder","key","iconCache","packedTeamNames","i","k","TeamFolder","props","cur","value","children","TeamBox","contents","icons","getPokemonIcon","button","noLink","TeamDropdownPanel","gen","setFormat","e","target","currentTarget","forceUpdate","click","curTarget","tagName","parentElement","chooseParentValue","getTeams","list","filter","render","room","parentElem","baseFormat","getAttribute","modid","isFirstLoad","availableWidth","document","body","offsetWidth","width","teamBuckets","teamList","baseGen","genList","hasOtherGens","sort","isEmpty","PSRoomPanel","FormatDropdownPanel","formatsLoaded","window","BattleFormats","selectType","formats","Object","values","challengeShow","searchShow","curSection","curColumnNum","curColumn","columns","column","section","replace","roomTypes","Component"],"mappings":"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","sourcesContent":["/**\r\n * Team Selector Panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nclass PSTeambuilder {\r\n\tstatic packTeam(team: PokemonSet[]) {\r\n\t\tlet buf = '';\r\n\t\tif (!team) return '';\r\n\r\n\t\tfor (const set of team) {\r\n\t\t\tlet hasHP = '';\r\n\t\t\tif (buf) buf += ']';\r\n\r\n\t\t\t// name\r\n\t\t\tbuf += set.name || set.species;\r\n\r\n\t\t\t// species\r\n\t\t\tlet id = toID(set.species);\r\n\t\t\tbuf += '|' + (toID(set.name || set.species) === id ? '' : id);\r\n\r\n\t\t\t// item\r\n\t\t\tbuf += '|' + toID(set.item);\r\n\r\n\t\t\t// ability\r\n\t\t\tid = toID(set.ability);\r\n\t\t\tbuf += '|' + (id || '-');\r\n\r\n\t\t\t// moves\r\n\t\t\tbuf += '|';\r\n\t\t\tif (set.moves) {\r\n\t\t\t\tfor (let j = 0; j < set.moves.length; j++) {\r\n\t\t\t\t\tlet moveid = toID(set.moves[j]);\r\n\t\t\t\t\tif (j && !moveid) continue;\r\n\t\t\t\t\tbuf += (j ? ',' : '') + moveid;\r\n\t\t\t\t\tif (moveid.substr(0, 11) === 'hiddenpower' && moveid.length > 11) {\r\n\t\t\t\t\t\thasHP = moveid.slice(11);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// nature\r\n\t\t\tbuf += '|' + (set.nature || '');\r\n\r\n\t\t\t// evs\r\n\t\t\tif (set.evs) {\r\n\t\t\t\tbuf += '|' + (set.evs['hp'] || '') + ',' +\r\n\t\t\t\t\t(set.evs['atk'] || '') + ',' +\r\n\t\t\t\t\t(set.evs['def'] || '') + ',' +\r\n\t\t\t\t\t(set.evs['spa'] || '') + ',' +\r\n\t\t\t\t\t(set.evs['spd'] || '') + ',' +\r\n\t\t\t\t\t(set.evs['spe'] || '');\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '|';\r\n\t\t\t}\r\n\r\n\t\t\t// gender\r\n\t\t\tif (set.gender) {\r\n\t\t\t\tbuf += '|' + set.gender;\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '|';\r\n\t\t\t}\r\n\r\n\t\t\t// ivs\r\n\t\t\tif (set.ivs) {\r\n\t\t\t\tbuf += '|' + (set.ivs['hp'] === 31 ? '' : set.ivs['hp']) + ',' +\r\n\t\t\t\t\t(set.ivs['atk'] === 31 ? '' : set.ivs['atk']) + ',' +\r\n\t\t\t\t\t(set.ivs['def'] === 31 ? '' : set.ivs['def']) + ',' +\r\n\t\t\t\t\t(set.ivs['spa'] === 31 ? '' : set.ivs['spa']) + ',' +\r\n\t\t\t\t\t(set.ivs['spd'] === 31 ? '' : set.ivs['spd']) + ',' +\r\n\t\t\t\t\t(set.ivs['spe'] === 31 ? '' : set.ivs['spe']);\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '|';\r\n\t\t\t}\r\n\r\n\t\t\t// shiny\r\n\t\t\tif (set.shiny) {\r\n\t\t\t\tbuf += '|S';\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '|';\r\n\t\t\t}\r\n\r\n\t\t\t// level\r\n\t\t\tif (set.level) {\r\n\t\t\t\tbuf += '|' + set.level;\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '|';\r\n\t\t\t}\r\n\r\n\t\t\t// happiness\r\n\t\t\tif (set.happiness !== undefined) {\r\n\t\t\t\tbuf += '|' + set.happiness;\r\n\t\t\t} else {\r\n\t\t\t\tbuf += '|';\r\n\t\t\t}\r\n\r\n\t\t\tif (set.pokeball || (set.hpType && toID(set.hpType) !== hasHP) || set.gigantamax) {\r\n\t\t\t\tbuf += ',' + (set.hpType || '');\r\n\t\t\t\tbuf += ',' + toID(set.pokeball);\r\n\t\t\t\tbuf += ',' + (set.gigantamax ? 'G' : '');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tstatic unpackTeam(buf: string) {\r\n\t\tif (!buf) return [];\r\n\r\n\t\tlet team: PokemonSet[] = [];\r\n\r\n\t\tfor (const setBuf of buf.split(`]`)) {\r\n\t\t\tconst parts = setBuf.split(`|`);\r\n\t\t\tif (parts.length < 11) continue;\r\n\t\t\tlet set: PokemonSet = {species: '', moves: []};\r\n\t\t\tteam.push(set);\r\n\r\n\t\t\t// name\r\n\t\t\tset.name = parts[0];\r\n\r\n\t\t\t// species\r\n\t\t\tset.species = Dex.species.get(parts[1]).name || set.name;\r\n\r\n\t\t\t// item\r\n\t\t\tset.item = Dex.items.get(parts[2]).name;\r\n\r\n\t\t\t// ability\r\n\t\t\tconst species = Dex.species.get(set.species);\r\n\t\t\tset.ability = parts[3] === '-' ?\r\n\t\t\t\t'' :\r\n\t\t\t\t(species.baseSpecies === 'Zygarde' && parts[3] === 'H') ?\r\n\t\t\t\t'Power Construct' :\r\n\t\t\t\t['', '0', '1', 'H', 'S'].includes(parts[3]) ?\r\n\t\t\t\tspecies.abilities[parts[3] as '0' || '0'] || (parts[3] === '' ? '' : '!!!ERROR!!!') :\r\n\t\t\t\tDex.abilities.get(parts[3]).name;\r\n\r\n\t\t\t// moves\r\n\t\t\tset.moves = parts[4].split(',').map(moveid =>\r\n\t\t\t\tDex.moves.get(moveid).name\r\n\t\t\t);\r\n\r\n\t\t\t// nature\r\n\t\t\tset.nature = parts[5] as NatureName;\r\n\t\t\tif (set.nature as any === 'undefined') set.nature = undefined;\r\n\r\n\t\t\t// evs\r\n\t\t\tif (parts[6]) {\r\n\t\t\t\tif (parts[6].length > 5) {\r\n\t\t\t\t\tconst evs = parts[6].split(',');\r\n\t\t\t\t\tset.evs = {\r\n\t\t\t\t\t\thp: Number(evs[0]) || 0,\r\n\t\t\t\t\t\tatk: Number(evs[1]) || 0,\r\n\t\t\t\t\t\tdef: Number(evs[2]) || 0,\r\n\t\t\t\t\t\tspa: Number(evs[3]) || 0,\r\n\t\t\t\t\t\tspd: Number(evs[4]) || 0,\r\n\t\t\t\t\t\tspe: Number(evs[5]) || 0,\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (parts[6] === '0') {\r\n\t\t\t\t\tset.evs = {hp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// gender\r\n\t\t\tif (parts[7]) set.gender = parts[7];\r\n\r\n\t\t\t// ivs\r\n\t\t\tif (parts[8]) {\r\n\t\t\t\tconst ivs = parts[8].split(',');\r\n\t\t\t\tset.ivs = {\r\n\t\t\t\t\thp: ivs[0] === '' ? 31 : Number(ivs[0]),\r\n\t\t\t\t\tatk: ivs[1] === '' ? 31 : Number(ivs[1]),\r\n\t\t\t\t\tdef: ivs[2] === '' ? 31 : Number(ivs[2]),\r\n\t\t\t\t\tspa: ivs[3] === '' ? 31 : Number(ivs[3]),\r\n\t\t\t\t\tspd: ivs[4] === '' ? 31 : Number(ivs[4]),\r\n\t\t\t\t\tspe: ivs[5] === '' ? 31 : Number(ivs[5]),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// shiny\r\n\t\t\tif (parts[9]) set.shiny = true;\r\n\r\n\t\t\t// level\r\n\t\t\tif (parts[10]) set.level = parseInt(parts[9], 10);\r\n\r\n\t\t\t// happiness\r\n\t\t\tif (parts[11]) {\r\n\t\t\t\tlet misc = parts[11].split(',', 4);\r\n\t\t\t\tset.happiness = (misc[0] ? Number(misc[0]) : undefined);\r\n\t\t\t\tset.hpType = misc[1];\r\n\t\t\t\tset.pokeball = misc[2];\r\n\t\t\t\tset.gigantamax = !!misc[3];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn team;\r\n\t}\r\n\t/**\r\n\t * (Exports end with two spaces so linebreaks are preserved in Markdown;\r\n\t * I assume mostly for Reddit.)\r\n\t */\r\n\tstatic exportSet(set: PokemonSet) {\r\n\t\tlet text = '';\r\n\r\n\t\t// core\r\n\t\tif (set.name && set.name !== set.species) {\r\n\t\t\ttext += `${set.name} (${set.species})`;\r\n\t\t} else {\r\n\t\t\ttext += `${set.species}`;\r\n\t\t}\r\n\t\tif (set.gender === 'M') text += ` (M)`;\r\n\t\tif (set.gender === 'F') text += ` (F)`;\r\n\t\tif (set.item) {\r\n\t\t\ttext += ` @ ${set.item}`;\r\n\t\t}\r\n\t\ttext += `  \\n`;\r\n\t\tif (set.ability) {\r\n\t\t\ttext += `Ability: ${set.ability}  \\n`;\r\n\t\t}\r\n\t\tif (set.moves) {\r\n\t\t\tfor (let move of set.moves) {\r\n\t\t\t\tif (move.substr(0, 13) === 'Hidden Power ') {\r\n\t\t\t\t\tconst hpType = move.slice(13);\r\n\t\t\t\t\tmove = move.slice(0, 13);\r\n\t\t\t\t\tmove = `${move}[${hpType}]`;\r\n\t\t\t\t}\r\n\t\t\t\tif (move) {\r\n\t\t\t\t\ttext += `- ${move}  \\n`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// stats\r\n\t\tlet first = true;\r\n\t\tif (set.evs) {\r\n\t\t\tfor (const stat of Dex.statNames) {\r\n\t\t\t\tif (!set.evs[stat]) continue;\r\n\t\t\t\tif (first) {\r\n\t\t\t\t\ttext += `EVs: `;\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext += ` / `;\r\n\t\t\t\t}\r\n\t\t\t\ttext += `${set.evs[stat]} ${BattleStatNames[stat]}`;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!first) {\r\n\t\t\ttext += `  \\n`;\r\n\t\t}\r\n\t\tif (set.nature) {\r\n\t\t\ttext += `${set.nature} Nature  \\n`;\r\n\t\t}\r\n\t\tfirst = true;\r\n\t\tif (set.ivs) {\r\n\t\t\tfor (const stat of Dex.statNames) {\r\n\t\t\t\tif (set.ivs[stat] === undefined || isNaN(set.ivs[stat]) || set.ivs[stat] === 31) continue;\r\n\t\t\t\tif (first) {\r\n\t\t\t\t\ttext += `IVs: `;\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttext += ` / `;\r\n\t\t\t\t}\r\n\t\t\t\ttext += `${set.ivs[stat]} ${BattleStatNames[stat]}`;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!first) {\r\n\t\t\ttext += `  \\n`;\r\n\t\t}\r\n\r\n\t\t// details\r\n\t\tif (set.level && set.level !== 100) {\r\n\t\t\ttext += `Level: ${set.level}  \\n`;\r\n\t\t}\r\n\t\tif (set.shiny) {\r\n\t\t\ttext += `Shiny: Yes  \\n`;\r\n\t\t}\r\n\t\tif (typeof set.happiness === 'number' && set.happiness !== 255 && !isNaN(set.happiness)) {\r\n\t\t\ttext += `Happiness: ${set.happiness}  \\n`;\r\n\t\t}\r\n\t\tif (set.gigantamax) {\r\n\t\t\ttext += `Gigantamax: Yes  \\n`;\r\n\t\t}\r\n\r\n\t\ttext += `\\n`;\r\n\t\treturn text;\r\n\t}\r\n\tstatic exportTeam(sets: PokemonSet[]) {\r\n\t\tlet text = '';\r\n\t\tfor (const set of sets) {\r\n\t\t\t// core\r\n\t\t\ttext += PSTeambuilder.exportSet(set);\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\tstatic splitPrefix(buffer: string, delimiter: string, prefixOffset = 0): [string, string] {\r\n\t\tconst delimIndex = buffer.indexOf(delimiter);\r\n\t\tif (delimIndex < 0) return ['', buffer];\r\n\t\treturn [buffer.slice(prefixOffset, delimIndex), buffer.slice(delimIndex + delimiter.length)];\r\n\t}\r\n\tstatic splitLast(buffer: string, delimiter: string): [string, string] {\r\n\t\tconst delimIndex = buffer.lastIndexOf(delimiter);\r\n\t\tif (delimIndex < 0) return [buffer, ''];\r\n\t\treturn [buffer.slice(0, delimIndex), buffer.slice(delimIndex + delimiter.length)];\r\n\t}\r\n\tstatic parseExportedTeamLine(line: string, isFirstLine: boolean, set: PokemonSet) {\r\n\t\tif (isFirstLine) {\r\n\t\t\tlet item;\r\n\t\t\t[line, item] = line.split(' @ ');\r\n\t\t\tif (item) {\r\n\t\t\t\tset.item = item;\r\n\t\t\t\tif (toID(set.item) === 'noitem') set.item = '';\r\n\t\t\t}\r\n\t\t\tif (line.endsWith(' (M)')) {\r\n\t\t\t\tset.gender = 'M';\r\n\t\t\t\tline = line.slice(0, -4);\r\n\t\t\t}\r\n\t\t\tif (line.endsWith(' (F)')) {\r\n\t\t\t\tset.gender = 'F';\r\n\t\t\t\tline = line.slice(0, -4);\r\n\t\t\t}\r\n\t\t\tlet parenIndex = line.lastIndexOf(' (');\r\n\t\t\tif (line.charAt(line.length - 1) === ')' && parenIndex !== -1) {\r\n\t\t\t\tset.species = Dex.species.get(line.slice(parenIndex + 2, -1)).name;\r\n\t\t\t\tset.name = line.slice(0, parenIndex);\r\n\t\t\t} else {\r\n\t\t\t\tset.species = Dex.species.get(line).name;\r\n\t\t\t\tset.name = '';\r\n\t\t\t}\r\n\t\t} else if (line.startsWith('Trait: ')) {\r\n\t\t\tline = line.slice(7);\r\n\t\t\tset.ability = line;\r\n\t\t} else if (line.startsWith('Ability: ')) {\r\n\t\t\tline = line.slice(9);\r\n\t\t\tset.ability = line;\r\n\t\t} else if (line === 'Shiny: Yes') {\r\n\t\t\tset.shiny = true;\r\n\t\t} else if (line.startsWith('Level: ')) {\r\n\t\t\tline = line.slice(7);\r\n\t\t\tset.level = +line;\r\n\t\t} else if (line.startsWith('Happiness: ')) {\r\n\t\t\tline = line.slice(11);\r\n\t\t\tset.happiness = +line;\r\n\t\t} else if (line.startsWith('Pokeball: ')) {\r\n\t\t\tline = line.slice(10);\r\n\t\t\tset.pokeball = line;\r\n\t\t} else if (line.startsWith('Hidden Power: ')) {\r\n\t\t\tline = line.slice(14);\r\n\t\t\tset.hpType = line;\r\n\t\t} else if (line === 'Gigantamax: Yes') {\r\n\t\t\tset.gigantamax = true;\r\n\t\t} else if (line.startsWith('EVs: ')) {\r\n\t\t\tline = line.slice(5);\r\n\t\t\tlet evLines = line.split('/');\r\n\t\t\tset.evs = {hp: 0, atk: 0, def: 0, spa: 0, spd: 0, spe: 0};\r\n\t\t\tfor (let evLine of evLines) {\r\n\t\t\t\tevLine = evLine.trim();\r\n\t\t\t\tlet spaceIndex = evLine.indexOf(' ');\r\n\t\t\t\tif (spaceIndex === -1) continue;\r\n\t\t\t\tlet statid = BattleStatIDs[evLine.slice(spaceIndex + 1)];\r\n\t\t\t\tif (!statid) continue;\r\n\t\t\t\tlet statval = parseInt(evLine.slice(0, spaceIndex), 10);\r\n\t\t\t\tset.evs[statid] = statval;\r\n\t\t\t}\r\n\t\t} else if (line.startsWith('IVs: ')) {\r\n\t\t\tline = line.slice(5);\r\n\t\t\tlet ivLines = line.split(' / ');\r\n\t\t\tset.ivs = {hp: 31, atk: 31, def: 31, spa: 31, spd: 31, spe: 31};\r\n\t\t\tfor (let ivLine of ivLines) {\r\n\t\t\t\tivLine = ivLine.trim();\r\n\t\t\t\tlet spaceIndex = ivLine.indexOf(' ');\r\n\t\t\t\tif (spaceIndex === -1) continue;\r\n\t\t\t\tlet statid = BattleStatIDs[ivLine.slice(spaceIndex + 1)];\r\n\t\t\t\tif (!statid) continue;\r\n\t\t\t\tlet statval = parseInt(ivLine.slice(0, spaceIndex), 10);\r\n\t\t\t\tif (isNaN(statval)) statval = 31;\r\n\t\t\t\tset.ivs[statid] = statval;\r\n\t\t\t}\r\n\t\t} else if (line.match(/^[A-Za-z]+ (N|n)ature/)) {\r\n\t\t\tlet natureIndex = line.indexOf(' Nature');\r\n\t\t\tif (natureIndex === -1) natureIndex = line.indexOf(' nature');\r\n\t\t\tif (natureIndex === -1) return;\r\n\t\t\tline = line.substr(0, natureIndex);\r\n\t\t\tif (line !== 'undefined') set.nature = line as NatureName;\r\n\t\t} else if (line.charAt(0) === '-' || line.charAt(0) === '~') {\r\n\t\t\tline = line.slice(line.charAt(1) === ' ' ? 2 : 1);\r\n\t\t\tif (line.startsWith('Hidden Power [')) {\r\n\t\t\t\tconst hpType = line.slice(14, -1) as TypeName;\r\n\t\t\t\tline = 'Hidden Power ' + hpType;\r\n\t\t\t\tif (!set.ivs && Dex.types.isName(hpType)) {\r\n\t\t\t\t\tset.ivs = {hp: 31, atk: 31, def: 31, spa: 31, spd: 31, spe: 31};\r\n\t\t\t\t\tconst hpIVs = Dex.types.get(hpType).HPivs || {};\r\n\t\t\t\t\tfor (let stat in hpIVs) {\r\n\t\t\t\t\t\tset.ivs[stat as StatName] = hpIVs[stat as StatName]!;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (line === 'Frustration' && set.happiness === undefined) {\r\n\t\t\t\tset.happiness = 0;\r\n\t\t\t}\r\n\t\t\tset.moves.push(line);\r\n\t\t}\r\n\t}\r\n\tstatic importTeam(buffer: string): PokemonSet[] {\r\n\t\tconst lines = buffer.split(\"\\n\");\r\n\r\n\t\tconst sets: PokemonSet[] = [];\r\n\t\tlet curSet: PokemonSet | null = null;\r\n\r\n\t\twhile (lines.length && !lines[0]) lines.shift();\r\n\t\twhile (lines.length && !lines[lines.length - 1]) lines.pop();\r\n\r\n\t\tif (lines.length === 1 && lines[0].includes('|')) {\r\n\t\t\treturn this.unpackTeam(lines[0]);\r\n\t\t}\r\n\t\tfor (let line of lines) {\r\n\t\t\tline = line.trim();\r\n\t\t\tif (line === '' || line === '---') {\r\n\t\t\t\tcurSet = null;\r\n\t\t\t} else if (line.startsWith('===')) {\r\n\t\t\t\t// team backup format; ignore\r\n\t\t\t} else if (line.includes('|')) {\r\n\t\t\t\t// packed format\r\n\t\t\t\tconst team = PS.teams.unpackLine(line);\r\n\t\t\t\tif (!team) continue;\r\n\t\t\t\treturn this.unpackTeam(team.packedTeam);\r\n\t\t\t} else if (!curSet) {\r\n\t\t\t\tcurSet = {\r\n\t\t\t\t\tname: '', species: '', gender: '',\r\n\t\t\t\t\tmoves: [],\r\n\t\t\t\t};\r\n\t\t\t\tsets.push(curSet);\r\n\t\t\t\tthis.parseExportedTeamLine(line, true, curSet);\r\n\t\t\t} else {\r\n\t\t\t\tthis.parseExportedTeamLine(line, false, curSet);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn sets;\r\n\t}\r\n\tstatic importTeamBackup(buffer: string): Team[] {\r\n\t\tconst teams: Team[] = [];\r\n\t\tconst lines = buffer.split(\"\\n\");\r\n\r\n\t\tlet curTeam: Team | null = null;\r\n\t\tlet sets: PokemonSet[] | null = null;\r\n\r\n\t\tlet curSet: PokemonSet | null = null;\r\n\r\n\t\twhile (lines.length && !lines[0]) lines.shift();\r\n\t\twhile (lines.length && !lines[lines.length - 1]) lines.pop();\r\n\r\n\t\tfor (let line of lines) {\r\n\t\t\tline = line.trim();\r\n\t\t\tif (line === '' || line === '---') {\r\n\t\t\t\tcurSet = null;\r\n\t\t\t} else if (line.startsWith('===')) {\r\n\t\t\t\tif (curTeam) {\r\n\t\t\t\t\t// not the first team, store the previous team\r\n\t\t\t\t\tcurTeam.packedTeam = this.packTeam(sets!);\r\n\t\t\t\t\tteams.push(curTeam);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurTeam = {\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\tformat: '' as ID,\r\n\t\t\t\t\tpackedTeam: '',\r\n\t\t\t\t\tfolder: '',\r\n\t\t\t\t\tkey: '',\r\n\t\t\t\t\ticonCache: '',\r\n\t\t\t\t};\r\n\t\t\t\tsets = [];\r\n\r\n\t\t\t\tline = line.slice(3, -3).trim();\r\n\t\t\t\t[curTeam.format, line] = this.splitPrefix(line, ']', 1) as [ID, string];\r\n\t\t\t\tif (!curTeam.format) curTeam.format = 'gen8' as ID;\r\n\t\t\t\telse if (!curTeam.format.startsWith('gen')) curTeam.format = `gen6${curTeam.format}` as ID;\r\n\r\n\t\t\t\t[curTeam.folder, curTeam.name] = this.splitPrefix(line, '/');\r\n\t\t\t} else if (line.includes('|')) {\r\n\t\t\t\tif (curTeam) {\r\n\t\t\t\t\t// not the first team, store the previous team\r\n\t\t\t\t\tcurTeam.packedTeam = this.packTeam(sets!);\r\n\t\t\t\t\tteams.push(curTeam);\r\n\t\t\t\t}\r\n\t\t\t\tcurTeam = null;\r\n\t\t\t\tcurSet = null;\r\n\t\t\t\tconst team = PS.teams.unpackLine(line);\r\n\t\t\t\tif (team) teams.push(team);\r\n\t\t\t} else if (!curSet) {\r\n\t\t\t\tif (!sets) continue; // corruption\r\n\t\t\t\tcurSet = {\r\n\t\t\t\t\tname: '', species: '', gender: '',\r\n\t\t\t\t\tmoves: [],\r\n\t\t\t\t};\r\n\t\t\t\tsets.push(curSet);\r\n\t\t\t\tthis.parseExportedTeamLine(line, true, curSet);\r\n\t\t\t} else {\r\n\t\t\t\tthis.parseExportedTeamLine(line, false, curSet);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (curTeam) {\r\n\t\t\tcurTeam.packedTeam = this.packTeam(sets!);\r\n\t\t\tteams.push(curTeam);\r\n\t\t}\r\n\t\treturn teams;\r\n\t}\r\n\r\n\tstatic packedTeamNames(buf: string) {\r\n\t\tif (!buf) return [];\r\n\r\n\t\tconst team = [];\r\n\t\tlet i = 0;\r\n\r\n\t\twhile (true) {\r\n\t\t\tconst name = buf.slice(i, buf.indexOf('|', i));\r\n\t\t\ti = buf.indexOf('|', i) + 1;\r\n\r\n\t\t\tteam.push(buf.slice(i, buf.indexOf('|', i)) || name);\r\n\r\n\t\t\tfor (let k = 0; k < 9; k++) {\r\n\t\t\t\ti = buf.indexOf('|', i) + 1;\r\n\t\t\t}\r\n\r\n\t\t\ti = buf.indexOf(']', i) + 1;\r\n\r\n\t\t\tif (i < 1) break;\r\n\t\t}\r\n\r\n\t\treturn team;\r\n\t}\r\n}\r\n\r\nfunction TeamFolder(props: {cur?: boolean, value: string, children: preact.ComponentChildren}) {\r\n\t// folders are <div>s rather than <button>s because in theory it has\r\n\t// less weird interactions with HTML5 drag-and-drop\r\n\tif (props.cur) {\r\n\t\treturn <div class=\"folder cur\"><div class=\"folderhack3\">\r\n\t\t\t<div class=\"folderhack1\"></div><div class=\"folderhack2\"></div>\r\n\t\t\t<div class=\"selectFolder\" data-value={props.value}>{props.children}</div>\r\n\t\t</div></div>;\r\n\t}\r\n\treturn <div class=\"folder\">\r\n\t\t<div class=\"selectFolder\" data-value={props.value}>{props.children}</div>\r\n\t</div>;\r\n}\r\n\r\nfunction TeamBox(props: {team: Team | null, noLink?: boolean, button?: boolean}) {\r\n\tconst team = props.team;\r\n\tlet contents;\r\n\tif (team) {\r\n\t\tlet icons = team.iconCache;\r\n\t\tif (!icons) {\r\n\t\t\tif (!team.packedTeam) {\r\n\t\t\t\ticons = <em>(empty team)</em>;\r\n\t\t\t} else {\r\n\t\t\t\ticons = PSTeambuilder.packedTeamNames(team.packedTeam).map(species =>\r\n\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(species)}></span>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tteam.iconCache = icons;\r\n\t\t}\r\n\t\tlet format = team.format as string;\r\n\t\tif (format.startsWith('gen8')) format = format.slice(4);\r\n\t\tformat = (format ? `[${format}] ` : ``) + (team.folder ? `${team.folder}/` : ``);\r\n\t\tcontents = [\r\n\t\t\t<strong>{format && <span>{format}</span>}{team.name}</strong>,\r\n\t\t\t<small>{icons}</small>,\r\n\t\t];\r\n\t} else {\r\n\t\tcontents = [\r\n\t\t\t<em>Select a team</em>,\r\n\t\t];\r\n\t}\r\n\tif (props.button) {\r\n\t\treturn <button class=\"team\" value={team ? team.key : ''}>\r\n\t\t\t{contents}\r\n\t\t</button>;\r\n\t}\r\n\treturn <div data-href={props.noLink ? '' : `/team-${team ? team.key : ''}`} class=\"team\" draggable>\r\n\t\t{contents}\r\n\t</div>;\r\n}\r\n\r\n/**\r\n * Team selector popup\r\n */\r\n\r\nclass TeamDropdownPanel extends PSRoomPanel {\r\n\tgen = '';\r\n\tformat: string | null = null;\r\n\tgetTeams() {\r\n\t\tif (!this.format && !this.gen) return PS.teams.list;\r\n\t\treturn PS.teams.list.filter(team => {\r\n\t\t\tif (this.gen && !team.format.startsWith(this.gen)) return false;\r\n\t\t\tif (this.format && team.format !== this.format) return false;\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\tsetFormat = (e: MouseEvent) => {\r\n\t\tconst target = e.currentTarget as HTMLButtonElement;\r\n\t\tthis.format = (target.name === 'format' && target.value) || '';\r\n\t\tthis.gen = (target.name === 'gen' && target.value) || '';\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tclick = (e: MouseEvent) => {\r\n\t\tlet curTarget = e.target as HTMLElement | null;\r\n\t\tlet target;\r\n\t\twhile (curTarget && curTarget !== e.currentTarget) {\r\n\t\t\tif (curTarget.tagName === 'BUTTON') {\r\n\t\t\t\ttarget = curTarget as HTMLButtonElement;\r\n\t\t\t}\r\n\t\t\tcurTarget = curTarget.parentElement;\r\n\t\t}\r\n\t\tif (!target) return;\r\n\r\n\t\tthis.chooseParentValue(target.value);\r\n\t};\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tif (!room.parentElem) {\r\n\t\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t\t<p>Error: You tried to open a team selector, but you have nothing to select a team for.</p>\r\n\t\t\t</PSPanelWrapper>;\r\n\t\t}\r\n\t\tconst baseFormat = room.parentElem.getAttribute('data-format') || Dex.modid;\r\n\t\tlet isFirstLoad = this.format === null;\r\n\t\tif (isFirstLoad) {\r\n\t\t\tthis.format = baseFormat;\r\n\t\t}\r\n\t\tlet teams = this.getTeams();\r\n\t\tif (!teams.length && this.format && isFirstLoad) {\r\n\t\t\tthis.gen = this.format.slice(0, 4);\r\n\t\t\tthis.format = '';\r\n\t\t\tteams = this.getTeams();\r\n\t\t}\r\n\t\tif (!teams.length && this.gen && isFirstLoad) {\r\n\t\t\tthis.gen = '';\r\n\t\t\tteams = this.getTeams();\r\n\t\t}\r\n\r\n\t\tlet availableWidth = document.body.offsetWidth;\r\n\t\tlet width = 307;\r\n\t\tif (availableWidth > 636) width = 613;\r\n\t\tif (availableWidth > 945) width = 919;\r\n\r\n\t\tlet teamBuckets: {[folder: string]: Team[]} = {};\r\n\t\tfor (const team of teams) {\r\n\t\t\tconst list = teamBuckets[team.folder] || (teamBuckets[team.folder] = []);\r\n\t\t\tlist.push(team);\r\n\t\t}\r\n\r\n\t\tlet teamList = [];\r\n\r\n\t\tconst baseGen = baseFormat.slice(0, 4);\r\n\t\tlet genList: string[] = [];\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tconst gen = team.format.slice(0, 4);\r\n\t\t\tif (gen && !genList.includes(gen)) genList.push(gen);\r\n\t\t}\r\n\t\tconst hasOtherGens = genList.length > 1 || genList[0] !== baseGen;\r\n\r\n\t\tteamList.push(<p>\r\n\t\t\t{baseFormat.length > 4 && <button class={'button' + (baseFormat === this.format ? ' disabled' : '')} onClick={this.setFormat} name=\"format\" value={baseFormat}>\r\n\t\t\t\t<i class=\"fa fa-folder-o\"></i> [{baseFormat.slice(0, 4)}] {baseFormat.slice(4)}\r\n\t\t\t</button>} <button class={'button' + (baseGen === this.format ? ' disabled' : '')} onClick={this.setFormat} name=\"format\" value={baseGen}>\r\n\t\t\t\t<i class=\"fa fa-folder-o\"></i> [{baseGen}] <em>(uncategorized)</em>\r\n\t\t\t</button> <button class={'button' + (baseGen === this.gen ? ' disabled' : '')} onClick={this.setFormat} name=\"gen\" value={baseGen}>\r\n\t\t\t\t<i class=\"fa fa-folder-o\"></i> [{baseGen}] <em>(all)</em>\r\n\t\t\t</button> {hasOtherGens && !this.gen && <button class=\"button\" onClick={this.setFormat} name=\"gen\" value={baseGen}>Other gens</button>}\r\n\t\t</p>);\r\n\r\n\t\tif (hasOtherGens && this.gen) {\r\n\t\t\tteamList.push(<h2>Other gens</h2>);\r\n\t\t\tteamList.push(<p>{genList.sort().map(gen => [\r\n\t\t\t\t<button class={'button' + (gen === this.gen ? ' disabled' : '')} onClick={this.setFormat} name=\"gen\" value={gen}>\r\n\t\t\t\t\t<i class=\"fa fa-folder-o\"></i> [{gen}] <em>(all)</em>\r\n\t\t\t\t</button>,\r\n\t\t\t\t\" \",\r\n\t\t\t])}</p>);\r\n\t\t}\r\n\r\n\t\tlet isEmpty = true;\r\n\t\tfor (let folder in teamBuckets) {\r\n\t\t\tif (folder && (this.gen || this.format)) {\r\n\t\t\t\tteamList.push(<h2>\r\n\t\t\t\t\t<i class=\"fa fa-folder-open\"></i> {folder} + {}\r\n\t\t\t\t\t<i class=\"fa fa-folder-open-o\"></i> {this.format || this.gen}\r\n\t\t\t\t</h2>);\r\n\t\t\t} else if (folder) {\r\n\t\t\t\tteamList.push(<h2>\r\n\t\t\t\t\t<i class=\"fa fa-folder-open\"></i> {folder}\r\n\t\t\t\t</h2>);\r\n\t\t\t} else if (this.gen || this.format) {\r\n\t\t\t\tteamList.push(<h2>\r\n\t\t\t\t\t<i class=\"fa fa-folder-open-o\"></i> {this.format || this.gen}\r\n\t\t\t\t</h2>);\r\n\t\t\t} else {\r\n\t\t\t\tteamList.push(<h2>\r\n\t\t\t\t\t<i class=\"fa fa-folder-open-o\"></i> Teams not in any folders\r\n\t\t\t\t</h2>);\r\n\t\t\t}\r\n\t\t\tteamList.push(<ul class=\"teamdropdown\" onClick={this.click}>\r\n\t\t\t\t{teamBuckets[folder].map(team => <li key={team.key} style={\"display:inline-block\"}>\r\n\t\t\t\t\t<TeamBox team={team} button />\r\n\t\t\t\t</li>)}\r\n\t\t\t</ul>);\r\n\t\t\tisEmpty = false;\r\n\t\t}\r\n\r\n\t\treturn <PSPanelWrapper room={room} width={width}>\r\n\t\t\t{teamList}\r\n\t\t\t{isEmpty && <p><em>No teams found</em></p>}\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\ninterface FormatData {\r\n\tid: ID;\r\n\tname: string;\r\n\tteam?: 'preset' | null;\r\n\tsection: string;\r\n\tcolumn: number;\r\n\tsearchShow?: boolean;\r\n\tchallengeShow?: boolean;\r\n\ttournamentShow?: boolean;\r\n\trated: boolean;\r\n\tteambuilderLevel?: number | null;\r\n\tteambuilderFormat?: ID;\r\n\tbattleFormat?: string;\r\n\tisTeambuilderFormat: boolean;\r\n\teffectType: 'Format';\r\n}\r\n\r\ndeclare var BattleFormats: {[id: string]: FormatData};\r\n/** id:name */\r\ndeclare var NonBattleGames: {[id: string]: string};\r\n\r\nclass FormatDropdownPanel extends PSRoomPanel {\r\n\tgen = '';\r\n\tformat: string | null = null;\r\n\tclick = (e: MouseEvent) => {\r\n\t\tlet curTarget = e.target as HTMLElement | null;\r\n\t\tlet target;\r\n\t\twhile (curTarget && curTarget !== e.currentTarget) {\r\n\t\t\tif (curTarget.tagName === 'BUTTON') {\r\n\t\t\t\ttarget = curTarget as HTMLButtonElement;\r\n\t\t\t}\r\n\t\t\tcurTarget = curTarget.parentElement;\r\n\t\t}\r\n\t\tif (!target) return;\r\n\r\n\t\tthis.chooseParentValue(target.value);\r\n\t};\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tif (!room.parentElem) {\r\n\t\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t\t<p>Error: You tried to open a format selector, but you have nothing to select a format for.</p>\r\n\t\t\t</PSPanelWrapper>;\r\n\t\t}\r\n\r\n\t\tlet formatsLoaded = !!window.BattleFormats;\r\n\t\tif (formatsLoaded) {\r\n\t\t\tformatsLoaded = false;\r\n\t\t\tfor (let i in window.BattleFormats) {\r\n\t\t\t\tformatsLoaded = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!formatsLoaded) {\r\n\t\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t\t<p>Loading...</p>\r\n\t\t\t</PSPanelWrapper>;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 'challenge' hides search-only formats, and 'search' hides challenge-only\r\n\t\t * formats. 'teambuilder' shows teambuilder formats (removing parentheses\r\n\t\t * from format names).\r\n\t\t */\r\n\t\tconst selectType: 'teambuilder' | 'challenge' | 'search' = (\r\n\t\t\troom.parentElem.getAttribute('data-selecttype') as any || 'challenge'\r\n\t\t);\r\n\r\n\t\tconst formats = Object.values(BattleFormats).filter(format => {\r\n\t\t\tif (selectType === 'challenge' && format.challengeShow === false) return false;\r\n\t\t\tif (selectType === 'search' && format.searchShow === false) return false;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tlet curSection = '';\r\n\t\tlet curColumnNum = 0;\r\n\t\tlet curColumn: (FormatData | {id: '', section: string})[] = [];\r\n\t\tconst columns = [curColumn];\r\n\t\tfor (const format of formats) {\r\n\t\t\tif (format.column !== curColumnNum) {\r\n\t\t\t\tif (curColumn.length) {\r\n\t\t\t\t\tcurColumn = [];\r\n\t\t\t\t\tcolumns.push(curColumn);\r\n\t\t\t\t}\r\n\t\t\t\tcurColumnNum = format.column;\r\n\t\t\t}\r\n\t\t\tif (format.section !== curSection) {\r\n\t\t\t\tcurSection = format.section;\r\n\t\t\t\tif (curSection) {\r\n\t\t\t\t\tcurColumn.push({id: '', section: curSection});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcurColumn.push(format);\r\n\t\t}\r\n\r\n\t\tconst width = columns.length * 225 + 10;\r\n\r\n\t\treturn <PSPanelWrapper room={room} width={width}>\r\n\t\t\t{columns.map(column => <ul class=\"options\" onClick={this.click}>\r\n\t\t\t\t{column.map(format => format.id ? (\r\n\t\t\t\t\t<li><button value={format.name} class=\"option\">\r\n\t\t\t\t\t\t{format.name.replace('[Gen 8 ', '[').replace('[Gen 8] ', '').replace('[Gen 7 ', '[')}\r\n\t\t\t\t\t</button></li>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<li><h3>\r\n\t\t\t\t\t\t{format.section}\r\n\t\t\t\t\t</h3></li>\r\n\t\t\t\t))}\r\n\t\t\t</ul>)}\r\n\t\t\t<div style=\"float: left\"></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['teamdropdown'] = {\r\n\tComponent: TeamDropdownPanel,\r\n};\r\n\r\nPS.roomTypes['formatdropdown'] = {\r\n\tComponent: FormatDropdownPanel,\r\n};\r\n"],"file":"panel-teamdropdown.js"}